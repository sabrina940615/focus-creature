<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Creature - 養成你的專注小生物</title>
    <meta name="description" content="透過記錄專注環境數據，生成與收集專屬於你的專注小生物圖鑑">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&family=Fredoka:wght@400;600&family=Varela+Round&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="app">
        <!-- Top Navigation Header -->
        <header id="top-nav" class="top-nav hidden">
            <button class="top-nav-btn" data-page="home">
                <span class="nav-icon">🏠</span>
                <span class="nav-label">主畫面</span>
            </button>
            <button class="top-nav-btn" data-page="collection">
                <span class="nav-icon">📚</span>
                <span class="nav-label">小生物圖鑑</span>
            </button>
        </header>

        <!-- Pages Container -->
        <main id="pages">
            <!-- Onboarding Page -->
            <section id="page-onboarding" class="page active">
                <div class="onboarding-container">
                    <div class="stars-bg"></div>
                    <div class="onboarding-content">
                        <div class="pixel-creature-intro">
                            <div class="creature-silhouette">?</div>
                        </div>
                        <h1 class="pixel-title">養成你的<br>專注小生物</h1>
                        <p class="onboarding-desc">
                            每個人都有獨特的專注環境偏好<br>
                            透過記錄你的專注時刻<br>
                            發現屬於你的專注小生物！
                        </p>
                        <button id="btn-start" class="pixel-btn primary">
                            開始探索
                        </button>
                    </div>
                </div>
            </section>

            <!-- Home Page -->
            <section id="page-home" class="page">
                <div class="page-header">
                    <h2 class="page-title">我的小生物</h2>
                </div>
                <div class="home-content">
                    <div class="creature-showcase">
                        <div id="main-creature" class="main-creature-display">
                            <div class="creature-placeholder">
                                <span>?</span>
                                <p>完成測驗解鎖你的小生物</p>
                            </div>
                        </div>
                    </div>
                    <div class="user-stats-summary">
                        <div class="stat-item">
                            <span class="stat-label">專注時間</span>
                            <span id="stat-total-time" class="stat-value">0</span>
                            <span class="stat-unit">分鐘</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">已解鎖</span>
                            <span id="stat-creatures" class="stat-value">0</span>
                            <span class="stat-unit">種類</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">完成測驗</span>
                            <span id="stat-sessions" class="stat-value">0</span>
                            <span class="stat-unit">次</span>
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="action-card" data-action="sound-test">
                            <div class="action-icon">🎵</div>
                            <div class="action-info">
                                <h3>聲音測驗</h3>
                                <p>測試你的聲音偏好</p>
                            </div>
                        </button>
                        <button class="action-card" data-action="task">
                            <div class="action-icon">⏱️</div>
                            <div class="action-info">
                                <h3>開始專注</h3>
                                <p>記錄你的專注環境</p>
                            </div>
                        </button>
                        <button class="action-card" data-action="sound-history">
                            <div class="action-icon">🎧</div>
                            <div class="action-info">
                                <h3>歷史聲音測驗</h3>
                                <p>查看過去的測驗記錄</p>
                            </div>
                        </button>
                        <button class="action-card" data-action="history">
                            <div class="action-icon">📋</div>
                            <div class="action-info">
                                <h3>歷史專注紀錄</h3>
                                <p>查看過去的專注記錄</p>
                            </div>
                        </button>
                    </div>
                    <div class="reset-section">
                        <button id="btn-reset-all-data" class="reset-btn">
                            🗑️ 重置所有數據
                        </button>
                    </div>
                </div>
            </section>

            <!-- Sound Test Page -->
            <section id="page-sound-test" class="page">
                <div class="page-header">
                    <h2 class="page-title">🎵 聲音專注測驗</h2>
                </div>

                <!-- Step 1: Environment Selection -->
                <div id="sound-step-1" class="sound-step active">
                    <h3 class="step-title">選擇測驗情境</h3>
                    <p class="step-desc">選擇一個環境，我們會播放對應的背景音</p>
                    <div class="environment-options">
                        <button class="env-option" data-env="cafe">
                            <div class="env-icon">☕</div>
                            <div class="env-name">咖啡廳</div>
                            <div class="env-desc">輕音樂與人聲</div>
                        </button>
                        <button class="env-option" data-env="library">
                            <div class="env-icon">📖</div>
                            <div class="env-name">圖書館</div>
                            <div class="env-desc">安靜白噪音</div>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Pre-test Survey (Hidden - soundLevel auto-defined) -->
                <div id="sound-step-2" class="sound-step hidden">
                    <h3 class="step-title">環境聲音感受</h3>
                    <p class="step-desc">聽一下現在的背景音，你覺得如何？</p>
                    <div class="audio-visualizer">
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                    </div>
                    <div class="pretest-options">
                        <button class="pretest-option" data-answer="quiet">
                            <span class="option-icon">🤫</span>
                            <span class="option-text">安靜</span>
                        </button>
                        <button class="pretest-option" data-answer="steady">
                            <span class="option-icon">🎶</span>
                            <span class="option-text">穩定背景音</span>
                        </button>
                        <button class="pretest-option" data-answer="noisy">
                            <span class="option-icon">📢</span>
                            <span class="option-text">多變吵雜</span>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Game -->
                <div id="sound-step-3" class="sound-step">
                    <div class="game-container">
                        <div class="game-header">
                            <div class="game-timer">
                                <span id="game-time">30</span>秒
                            </div>
                            <div class="game-score">
                                正確: <span id="game-correct">0</span>
                            </div>
                            <div class="game-score">
                                錯誤: <span id="game-error">0</span>
                            </div>
                        </div>
                        <div class="game-instructions">
                            <p>看到 <strong>1,2,4,5,6,7,8,9</strong> → 點擊螢幕</p>
                            <p>看到 <strong class="warning">3</strong> → 不要點擊！</p>
                        </div>
                        <div id="game-area" class="game-area">
                            <div id="game-number" class="game-number">準備</div>
                        </div>
                        <button id="btn-start-game" class="pixel-btn primary">開始遊戲</button>
                    </div>
                </div>

                <!-- Step 4: Results -->
                <div id="sound-step-4" class="sound-step">
                    <div class="results-container">
                        <h3 class="step-title">測驗結果</h3>
                        <!-- Creature reveal hidden - only show stats -->
                        <div class="creature-reveal" style="display: none;">
                            <div id="sound-creature" class="revealed-creature"></div>
                            <p class="creature-name">聲音小生物</p>
                            <div id="creature-intro" class="creature-intro">
                                <p class="intro-text">恭喜解鎖新的小生物!</p>
                            </div>
                        </div>
                        <div class="results-stats">
                            <div class="result-item">
                                <span class="result-label">反應時間</span>
                                <span id="result-reaction" class="result-value">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">正確率</span>
                                <span id="result-accuracy" class="result-value">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">誤點率</span>
                                <span id="result-error" class="result-value">--</span>
                            </div>
                        </div>
                        <p class="data-saved-notice"
                            style="text-align: center; color: var(--accent-green, #2ecc71); margin: 20px 0; font-size: 0.9rem;">
                            ✅ 資料已成功匯入小生物數據庫
                        </p>
                        <button id="btn-finish-test" class="pixel-btn primary">返回首頁</button>
                    </div>
                </div>
            </section>

            <!-- Task Session Page -->
            <section id="page-task" class="page">
                <div class="page-header">
                    <h2 class="page-title">⏱️ 專注任務</h2>
                </div>

                <!-- Step A: Environment Setup -->
                <div id="task-step-a" class="task-step active">
                    <div class="task-intro">
                        <p class="intro-text">📝 記錄你的環境</p>
                        <p class="intro-sub">要知道環境才可以知道你適合養什麼小生物喔！</p>
                    </div>

                    <div class="env-form">
                        <div class="form-group">
                            <label>時段</label>
                            <div class="option-group">
                                <button class="form-option" data-field="period" data-value="morning">🌅 早上</button>
                                <button class="form-option" data-field="period" data-value="afternoon">☀️ 下午</button>
                                <button class="form-option" data-field="period" data-value="evening">🌙 晚上</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>地點</label>
                            <div class="option-group">
                                <button class="form-option" data-field="location" data-value="home">🏠 家</button>
                                <button class="form-option" data-field="location" data-value="classroom">🏫 教室</button>
                                <button class="form-option" data-field="location" data-value="cafe">☕ 咖啡廳</button>
                                <button class="form-option" data-field="location" data-value="library">📚 圖書館</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>💡 光線</label>
                            <div class="option-group">
                                <button class="form-option" data-field="light" data-value="1">偏暗</button>
                                <button class="form-option" data-field="light" data-value="2">剛好</button>
                                <button class="form-option" data-field="light" data-value="3">偏亮</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>🌡️ 溫度</label>
                            <div class="option-group">
                                <button class="form-option" data-field="temperature" data-value="1">偏冷</button>
                                <button class="form-option" data-field="temperature" data-value="2">剛好</button>
                                <button class="form-option" data-field="temperature" data-value="3">偏熱</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>🔊 聲音</label>
                            <div class="option-group">
                                <button class="form-option" data-field="sound" data-value="1">安靜</button>
                                <button class="form-option" data-field="sound" data-value="2">穩定背景音</button>
                                <button class="form-option" data-field="sound" data-value="3">多變吵雜</button>
                            </div>
                        </div>

                        <button id="btn-next-timer" class="pixel-btn primary" disabled>選擇專注時間 →</button>
                    </div>
                </div>

                <!-- Step B: Timer -->
                <div id="task-step-b" class="task-step">
                    <div class="timer-setup">
                        <h3>選擇專注時間</h3>
                        <div class="duration-options">
                            <button class="duration-option" data-duration="30">30 分鐘</button>
                            <button class="duration-option" data-duration="60">1 小時</button>
                            <button class="duration-option" data-duration="120">2 小時</button>
                        </div>
                    </div>
                    <div class="timer-display hidden">
                        <div class="timer-circle">
                            <svg class="timer-svg" viewBox="0 0 200 200">
                                <circle class="timer-bg" cx="100" cy="100" r="90" />
                                <circle id="timer-progress" class="timer-progress" cx="100" cy="100" r="90" />
                            </svg>
                            <div class="timer-text">
                                <span id="timer-minutes">00</span>:<span id="timer-seconds">00</span>
                            </div>
                        </div>
                        <div class="timer-actions">
                            <button id="btn-pause" class="pixel-btn secondary">暫停</button>
                            <button id="btn-complete" class="pixel-btn primary">完成</button>
                        </div>
                    </div>
                </div>

                <!-- Step C: Review -->
                <div id="task-step-c" class="task-step">
                    <div class="review-container">
                        <h3 class="step-title">🎉 時間到！</h3>
                        <p class="step-desc">記錄你的任務完成度</p>

                        <div class="form-group">
                            <label>任務連續性</label>
                            <div class="review-options">
                                <button class="review-option" data-field="continuity" data-value="1">
                                    <span class="option-icon">✅</span>
                                    <span class="option-text">連續完成（沒有換任務）</span>
                                </button>
                                <button class="review-option" data-field="continuity" data-value="2">
                                    <span class="option-icon">↩️</span>
                                    <span class="option-text">有短暫切換（回得來）</span>
                                </button>
                                <button class="review-option" data-field="continuity" data-value="3">
                                    <span class="option-icon">🔄</span>
                                    <span class="option-text">一直在切換（回不來）</span>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>完成狀態</label>
                            <div class="review-options">
                                <button class="review-option" data-field="completion" data-value="1">
                                    <span class="option-icon">🎯</span>
                                    <span class="option-text">完成原本預期的進度</span>
                                </button>
                                <button class="review-option" data-field="completion" data-value="2">
                                    <span class="option-icon">📊</span>
                                    <span class="option-text">完成一部分</span>
                                </button>
                                <button class="review-option" data-field="completion" data-value="3">
                                    <span class="option-icon">😅</span>
                                    <span class="option-text">幾乎沒進展</span>
                                </button>
                            </div>
                        </div>

                        <button id="btn-submit-review" class="pixel-btn primary" disabled>儲存紀錄</button>
                    </div>
                </div>
            </section>

            <!-- Collection Page -->
            <section id="page-collection" class="page">
                <div class="page-header">
                    <h2 class="page-title">📚 生物圖鑑</h2>
                </div>
                <div class="collection-tabs">
                    <button class="tab-btn active" data-tab="all">全部</button>
                    <button class="tab-btn" data-tab="sound">聲音</button>
                    <button class="tab-btn" data-tab="light">光線</button>
                    <button class="tab-btn" data-tab="temperature">溫度</button>
                    <button class="tab-btn" data-tab="composite">合成</button>
                </div>
                <div id="collection-grid" class="collection-grid">
                    <!-- Creatures will be dynamically inserted -->
                </div>
            </section>

            <!-- Stats Page -->
            <section id="page-stats" class="page">
                <div class="page-header">
                    <h2 class="page-title">📊 數據分析</h2>
                </div>
                <div class="stats-content">
                    <div class="radar-chart-container">
                        <h3>環境偏好雷達圖</h3>
                        <canvas id="radar-chart" width="300" height="300"></canvas>
                    </div>
                    <div class="insights-container">
                        <h3>你的專注洞察</h3>
                        <div id="insights-list" class="insights-list">
                            <p class="no-data">累積更多數據後解鎖分析</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Audio Elements -->
    <audio id="audio-cafe" loop preload="auto">
        <source src="assets/sounds/cafe.mp3" type="audio/mpeg">
    </audio>
    <audio id="audio-cafe-ambience" loop preload="auto">
        <source src="assets/sounds/cafe-ambience.mp3" type="audio/mpeg">
    </audio>
    <audio id="audio-library" loop preload="auto">
        <source src="assets/sounds/library.mp3" type="audio/mpeg">
    </audio>

    <!-- Scripts -->
    <script src="js/db/database.js"></script>
    <script src="js/utils/creatureGenerator.js"></script>
    <script src="js/utils/statisticsHelper.js"></script>
    <script src="js/games/inhibitoryControl.js"></script>
    <script src="js/modules/navigation.js"></script>
    <script src="js/modules/onboarding.js"></script>
    <script src="js/modules/unlockNotification.js"></script>
    <script src="js/modules/soundTest.js"></script>
    <script src="js/modules/taskSession.js"></script>
    <script src="js/modules/collection.js"></script>
    <script src="js/modules/stats.js"></script>
    <script src="js/app.js"></script>
</body>

</html>